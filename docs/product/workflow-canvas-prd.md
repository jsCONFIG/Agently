# Workflow Canvas MVP Definition

## 1. 用户访谈与需求洞察

### 目标用户画像
- **AI 应用工程师**：负责组装多模型、多服务的 AI 工作流，关注可扩展性、调试效率与自动化部署。
- **产品运营（Growth/运营）**：负责策划 A/B 测试、活动工作流与监控数据表现，关注可视化、协同、快速试错。

### 访谈要点与痛点
| 用户 | 关键目标 | 痛点 | 需求洞察 |
| --- | --- | --- | --- |
| AI 应用工程师 | 快速搭建可复用的 AI 流程 | 现有脚本维护成本高；缺乏版本管理；节点参数配置复杂 | 需要模块化节点库、参数模板和可视化调试能力 |
| 产品运营 | 快速组合营销/运营自动化流程并监控结果 | 对技术依赖大；执行状态不透明；协同难 | 需要直观工作流编排、权限/协同机制与实时监控 |

### MVP 最小可用特性清单
1. **可视化 Canvas 工作流编排**：拖拽节点、连线、保存流程。
2. **核心节点类型库**：触发器、模型调用、逻辑控制（条件/分支）、工具节点（API/数据库）。
3. **节点属性配置面板**：表单化编辑、参数校验、常用模板。
4. **工作流版本管理（基础）**：手动创建版本、版本对比关键变更、回滚。
5. **执行监控面板（基础）**：展示运行历史、状态、耗时、错误日志。
6. **协作与权限（基础）**：拥有者与编辑者区分、操作审计日志。
7. **快速发布/执行入口**：从流程列表触发运行或导出配置。

## 2. 用户旅程与主要用例流程

### 高阶旅程图
1. **探索**：用户登录 → 浏览模板/工作流列表 → 选择新建或复制模板。
2. **构建**：在 Canvas 中拖拽节点 → 配置属性 → 校验连线 → 保存草稿。
3. **测试**：执行试运行 → 查看日志 → 调整节点参数 → 生成版本。
4. **发布**：设置触发方式 → 邀请协作者 → 标记为线上版本。
5. **监控与优化**：查看执行监控 → 导出报表 → 迭代流程。

### 主要用例流程（文本泳道）
- **UC-01 创建新工作流**：
  - 用户：选择“新建”→ 选择空白/模板 → 重命名 → 进入 Canvas。
  - 系统：初始化默认节点区域 → 提供节点库 → 自动保存草稿。
- **UC-02 配置节点并连线**：
  - 用户：拖入节点 → 设置输入输出 → 通过连线器连接 → 校验通过。
  - 系统：实时检查数据类型 → 抛出警告/建议修复。
- **UC-03 试运行与调试**：
  - 用户：选择测试数据 → 点击试运行 → 查看节点级日志。
  - 系统：展示执行时间轴 → 标记失败节点 → 支持重新运行。
- **UC-04 发布与协作**：
  - 用户：锁定版本 → 设置权限（仅查看/可编辑） → 发布到生产。
  - 系统：记录版本号与变更摘要 → 推送通知给协作者。
- **UC-05 监控与回滚**：
  - 用户：在监控页查看执行指标 → 发现异常 → 选择历史版本回滚。
  - 系统：验证依赖 → 更新当前生产版本 → 生成审计日志。

### 功能优先级（MoSCoW）
| 功能模块 | Must | Should | Could | Won't (MVP) |
| --- | --- | --- | --- | --- |
| 节点类型 | 触发器、模型调用、条件、工具节点 | 自定义脚本节点 | AI 代理节点市场 | 高级 ML Ops 节点 |
| 连线与校验 | 单向连线、类型校验、分支 | 多播连线 | 条件表达式生成器 | 循环连线 |
| 属性配置 | 表单编辑、参数模板、校验 | 参数版本比较 | 参数智能推荐 | AI 自动调参 |
| 版本管理 | 手动版本、回滚、差异摘要 | 标签/分支管理 | 自动版本策略 | 多环境发布流程 |
| 协作与权限 | 拥有者/编辑者/查看者 | 评论区 | 审批流 | 完整 RBAC |
| 执行监控 | 运行历史、状态、日志 | KPI 仪表盘 | 智能告警 | SLA 合规报告 |

## 3. 信息架构与界面草图

### 信息架构（IA）概览
- **顶层导航**
  - 工作流列表
  - Canvas 编辑器（含节点库、属性面板、运行面板）
  - 执行监控
  - 设置（节点模板、权限管理）
- **关键对象**
  - Workflow（工作流）：包含节点集合、连线、版本信息。
  - Node 节点：类型、参数、输入输出、运行日志。
  - Run 执行：状态、耗时、触发信息、日志。
  - Template 模板：预设工作流/节点参数集合。

### 界面草图描述
1. **Canvas 主界面**
   - 左侧：节点库（分类：触发器、模型、逻辑、工具、自定义）。
   - 中央：无限画布，支持缩放、对齐网格、节点堆叠层级。
   - 右侧：属性配置面板，顶部显示节点名称，下方是参数表单、校验提示、版本信息。
   - 底部浮层：执行控制（试运行、保存、发布）、运行状态提示。
2. **节点编辑器（弹出/侧边）**
   - 头部：节点类型标识、版本标签。
   - 主体：分区展示输入参数、输出设置、错误处理策略。
   - 底部：测试面板（输入示例、输出预览）、保存/取消按钮。
3. **工作流列表**
   - 顶部筛选：按标签、状态、拥有者排序。
  - 列表项：名称、更新时间、当前版本、最后执行状态、快捷操作（编辑、运行、复制）。
   - 批量操作：批量发布、批量归档。
4. **执行监控面板**
   - 概览卡片：成功率、平均耗时、失败次数。
   - 时间轴：按运行批次展开节点执行详情。
   - 错误日志：支持关键字搜索、导出 JSON。
   - 告警设置（MVP Should）：阈值、通知渠道。

### 交互与状态管理要点
- 自动保存草稿，失败时提示离线缓存恢复。
- 版本锁定后限制编辑，需复制版本或申请权限。
- Canvas 支持撤销/重做（历史步栈）。
- 执行监控支持实时刷新与分页加载历史记录。

## 4. PRD 与原型评审 / MVP 冻结

### 评审要点
- 与工程、设计、运营对齐：确认节点类型范围、版本管理流程、监控指标。
- 技术可行性确认：连线校验规则、执行日志结构、权限控制实现方式。
- 运营反馈：关注模板市场与协作需求，确认 MVP 中仅提供基础权限和手动版本。

### MVP 范围冻结
- **包含**：上述 Must-have 功能；Should 功能中的试运行日志细分、告警阈值配置（仅基础）。
- **排除**：自动化智能推荐、复杂权限/审批、AI 节点市场、循环连线等高复杂功能。

### 验收标准
1. 用户可在 Canvas 中创建 ≥5 个节点的工作流并成功保存、执行试运行。
2. 所有节点参数具备必填校验，试运行失败时在监控面板显示错误日志。
3. 版本管理支持手动创建、差异摘要、回滚，操作记录在审计日志中可查。
4. 工作流列表展示最新执行状态，执行监控可按运行批次查看节点详情。
5. 至少支持两级权限（编辑/查看），协作者操作被记录。

### 后续迭代建议
- 集成自动告警推送（Webhook/Slack）。
- 引入模板市场与节点 SDK 插件机制。
- 提供 A/B Testing 流程和指标报表。

